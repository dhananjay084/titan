
// (function () {
//   try {
//     var BUILD_ID = "octaads-2025-rtg-geo-time-03";
//     if (window.__OCTAADS_LOADED === BUILD_ID) return;
//     window.__OCTAADS_LOADED = BUILD_ID;

//     /* ===============================
//        IST TIME CHECK: 4:00 PM – 1:00 AM
//     =============================== */
//     function isAllowedISTTime() {
//       var now = new Date(
//         new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
//       );
//       var minutes = now.getHours() * 60 + now.getMinutes();
//       return minutes >= 960 || minutes <= 60;
//     }
//     if (!isAllowedISTTime()) return;

//     /* ===============================
//        SESSION ID
//     =============================== */
//     function getSessionID() {
//       var m = document.cookie.match(/octaads_sid=([^;]+)/);
//       if (m) return m[1];

//       var sid = "sid_" + Math.random().toString(36).substr(2, 10);
//       document.cookie =
//         "octaads_sid=" + sid + "; path=/; max-age=2592000; SameSite=Lax";
//       return sid;
//     }
//     var sessionID = getSessionID();

//     /* ===============================
//        BLOCKED REGIONS (INDIA)
//        DL = Delhi
//        HR = Gurugram
//        UP = Noida
//        KA = Bangalore
//     =============================== */
//     var blockedRegions = ["DL", "HR", "UP", "KA"];

//     /* ===============================
//        GEO CHECK – CLOUDFLARE (NO LIMIT)
//     =============================== */
//     fetch("https://www.cloudflare.com/cdn-cgi/trace", { cache: "no-store" })
//       .then(function (r) { return r.text(); })
//       .then(function (text) {
//         var data = {};
//         text.trim().split("\n").forEach(function (line) {
//           var parts = line.split("=");
//           data[parts[0]] = parts[1];
//         });

//         /* INDIA ONLY */
//         if (data.loc !== "IN") return;

//         /* BLOCK REGIONS */
//         if (blockedRegions.indexOf(data.region) !== -1) return;

//         /* ===============================
//            SET COOKIES
//         =============================== */
//         function setCookie(n, v) {
//           document.cookie =
//             n + "=" + v + "; path=/; max-age=2592000; SameSite=Lax";
//         }

//         setCookie("utm_source", "octaads");
//         setCookie("utm_content", "_6960ebd248afd6034bed6933");
//         setCookie("utm_term", "4");
//         setCookie("utm_medium", "affiliate");
//         setCookie("utm_campaign", "ti_best_buy_apr24");
//         setCookie("sessionid", sessionID);
//         setCookie("clickId", sessionID);

//         /* ===============================
//            FIRE TRACKIER
//         =============================== */
//         function fireIframe() {
//           var iframe = document.createElement("iframe");
//           iframe.style.display = "none";
//           iframe.referrerPolicy = "no-referrer";
//           iframe.src =
//             "https://octaads.gotrackier.com/click" +
//             "?campaign_id=2651" +
//             "&pub_id=4" +
//             "&p1=" + encodeURIComponent(sessionID) +
//             "&source=" + encodeURIComponent(sessionID);

//           document.body.appendChild(iframe);
//         }

//         if (document.body) fireIframe();
//         else document.addEventListener("DOMContentLoaded", fireIframe);
//       })
//       .catch(function () {});

//   } catch (e) {}
// })();


// <script>
<script>
(function () {
  const TRACKIER_CLICK_URL =
    "https://octaads.gotrackier.com/click?campaign_id=2651&pub_id=4";
  const BACKEND_CONVERSION =
    "https://octaads-tracker.onrender.com/conversion";

  /* ===============================
     COOKIE HELPERS
  =============================== */
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + days * 86400000);
    document.cookie =
      name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
  }

  function getCookie(name) {
    return document.cookie
      .split("; ")
      .find(row => row.startsWith(name + "="))
      ?.split("=")[1];
  }

  function uuidv4() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, c => {
      const r = (Math.random() * 16) | 0;
      const v = c === "x" ? r : (r & 0x3) | 0x8;
      return v.toString(16);
    });
  }

  /* ===============================
     CLICK FIRE (ONCE PER USER)
  =============================== */
  let clickId = getCookie("octaads_click_id");

  if (!clickId) {
    clickId = uuidv4();
    setCookie("octaads_click_id", clickId, 30);

    const img = document.createElement("img");
    img.src = TRACKIER_CLICK_URL + "&p1=" + encodeURIComponent(clickId);
    img.referrerPolicy = "no-referrer";

    img.width = 1;
    img.height = 1;
    img.style.display = "none";
    document.body.appendChild(img);

    console.log("[OctaAds] Click fired:", clickId);
  } else {
    console.log("[OctaAds] Existing click:", clickId);
  }

  /* ===============================
     MULTIPLE SALES SUPPORT
  =============================== */
  function listenForPurchase() {
    if (!window.dataLayer || !Array.isArray(window.dataLayer)) return;

    const purchase = window.dataLayer.find(
      e => e.event === "purchase" && e.ecommerce
    );
    if (!purchase) return;

    const orderId = purchase.ecommerce.transaction_id?.[0];
    const amount = purchase.ecommerce.value;
    const currency = purchase.ecommerce.currency || "INR";

    if (!orderId || !amount) return;

    // prevent SAME ORDER firing twice
    const key = "octaads_sale_" + orderId;
    if (localStorage.getItem(key)) return;
    localStorage.setItem(key, "1");

    fetch(BACKEND_CONVERSION, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        click_id: clickId,
        order_id: orderId,
        sale_amount: amount,
        currency,
        client_time: new Date().toISOString(),
        client_country: "India"
      })
    })
      .then(r => r.json())
      .then(d => console.log("[OctaAds] Sale tracked:", d))
      .catch(e => console.error("[OctaAds] Sale error:", e));
  }

  setInterval(listenForPurchase, 1000);
})();
</script>




// </script>


